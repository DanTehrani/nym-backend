// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TreeNode {
  id        Int       @id @default(autoincrement())
  parent_id Int?
  value     BigInt
  createdAt DateTime  @default(now())
  deletedAt DateTime?
}

// Post, Reply, PostUpvote, ReplyUpvote are new models in Nym

model PsuedoPost {
  hash           String        @id
  parentHash     String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  title          String        @db.VarChar(255)
  content        String
  venue          String
  upvotes        DoxedUpvote[]
  proof          String
  psuedoPostHash String?
}

model DoxedPost {
  hash       String        @id
  parentHash String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  title      String        @db.VarChar(255)
  content    String
  venue      String
  upvotes    DoxedUpvote[]
  sig        String
  address    String
}

model DoxedUpvote {
  postHash       String
  upvoteBy       String
  sig            String
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  PsuedoPost     PsuedoPost? @relation(fields: [psuedoPostHash], references: [hash])
  psuedoPostHash String?
  DoxedPost      DoxedPost?  @relation(fields: [doxedPostHash], references: [hash])
  doxedPostHash  String?

  @@unique([upvoteBy, postHash])
}
